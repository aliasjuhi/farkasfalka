(function(e,r){typeof exports=="object"&&typeof module!="undefined"?r(exports,require("@apollo/client"),require("@nhost/react"),require("react"),require("@apollo/client/core"),require("@apollo/client/link/context"),require("@apollo/client/link/subscriptions"),require("@apollo/client/utilities"),require("graphql-ws"),require("react/jsx-runtime")):typeof define=="function"&&define.amd?define(["exports","@apollo/client","@nhost/react","react","@apollo/client/core","@apollo/client/link/context","@apollo/client/link/subscriptions","@apollo/client/utilities","graphql-ws","react/jsx-runtime"],r):(e=typeof globalThis!="undefined"?globalThis:e||self,r(e["@nhost/react-apollo"]={},e["@apollo/client"],e["@nhost/react"],e.React,e["@apollo/client/core"],e["@apollo/client/link/context"],e["@apollo/client/link/subscriptions"],e["@apollo/client/utilities"],e["graphql-ws"],e._jsx))})(this,function(e,r,i,l,p,U,H,R,W,z){"use strict";var re=Object.defineProperty,ne=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var M=(e,r,i)=>r in e?re(e,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[r]=i,S=(e,r)=>{for(var i in r||(r={}))G.call(r,i)&&M(e,i,r[i]);if(A)for(var i of A(r))L.call(r,i)&&M(e,i,r[i]);return e},q=(e,r)=>ne(e,oe(r));var Q=(e,r)=>{var i={};for(var l in e)G.call(e,l)&&r.indexOf(l)<0&&(i[l]=e[l]);if(e!=null&&A)for(var l of A(e))r.indexOf(l)<0&&L.call(e,l)&&(i[l]=e[l]);return i};function B(n,t){const o=i.useAuthenticated(),s=q(S({},t),{skip:(t==null?void 0:t.skip)||!o});return r.useQuery(n,s)}function K(n,t){const o=i.useAuthenticated(),s=q(S({},t),{skip:(t==null?void 0:t.skip)||!o});return r.useSubscription(n,s)}var V=Object.defineProperty,$=Object.defineProperties,F=Object.getOwnPropertyDescriptors,b=Object.getOwnPropertySymbols,J=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable,j=(n,t,o)=>t in n?V(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,c=(n,t)=>{for(var o in t||(t={}))J.call(t,o)&&j(n,o,t[o]);if(b)for(var o of b(t))X.call(t,o)&&j(n,o,t[o]);return n},y=(n,t)=>$(n,F(t));function Y(n){let t=!1,o=()=>{t=!0},s=!1;const d=()=>s,w=W.createClient(y(c({},n),{on:y(c({},n.on),{connected:()=>{s=!0},opened:P=>{var f,_;const h=P;(_=(f=n.on)==null?void 0:f.opened)==null||_.call(f,h),o=()=>{h.readyState===WebSocket.OPEN?h.close(4205,"Client Restart"):t=!0},t&&(t=!1,o())}})}));return y(c({},w),{restart:()=>o(),started:d})}const v=typeof window!="undefined",Z=({nhost:n,graphqlUrl:t,headers:o={},publicRole:s="public",fetchPolicy:d,cache:w=new p.InMemoryCache,connectToDevTools:P=v&&!1,onError:f})=>{let _=t||(n==null?void 0:n.graphql.getUrl());if(!_)throw Error("Can't initialize the Apollo Client: no backend Url has been provided");const h=n==null?void 0:n.auth.client.interpreter;let C=null;const N=()=>{const a=y(c({},o),{"Sec-WebSocket-Protocol":"graphql-ws"});return C?a.authorization=`Bearer ${C}`:a.role=s,a},O=_,k=v&&Y({url:O.startsWith("https")?O.replace(/^https/,"wss"):O.replace(/^http/,"ws"),connectionParams:()=>({headers:c(c({},o),N())})}),T=k&&new H.GraphQLWsLink(k),x=U.setContext((a,{headers:u})=>({headers:c(c({},u),N())})).concat(p.createHttpLink({uri:O})),I=T?p.split(({query:a})=>{const u=R.getMainDefinition(a),{kind:D}=u;let m;return"operation"in u&&(m=u.operation),D==="OperationDefinition"&&m==="subscription"},T,x):x,E={cache:w||new p.InMemoryCache,ssrMode:!v,defaultOptions:{watchQuery:{fetchPolicy:d}},connectToDevTools:P};E.link=typeof f=="function"?p.from([f,I]):p.from([I]);const g=new p.ApolloClient(E);return h==null||h.onTransition(async(a,u)=>{if(["SIGNOUT","SIGNED_IN","TOKEN_CHANGED"].includes(u.type))if(C=a.context.accessToken.value,u.type==="SIGNOUT")try{await g.resetStore()}catch(m){console.error("Error resetting Apollo client cache"),console.error(m)}else v&&k&&k.started()&&k.restart()}),g},ee=new r.ApolloClient({cache:new r.InMemoryCache}),te=o=>{var s=o,{children:n}=s,t=Q(s,["children"]);const[d,w]=l.useState();return l.useEffect(()=>{d||w(Z(t))},[]),z.jsx(r.ApolloProvider,{client:d||ee,children:n})};e.NhostApolloProvider=te,e.useAuthQuery=B,e.useAuthSubscription=K,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=react-apollo.umd.js.map
