(function(d,c){typeof exports=="object"&&typeof module!="undefined"?c(exports,require("@apollo/client/core"),require("@apollo/client/link/context"),require("@apollo/client/link/subscriptions"),require("@apollo/client/utilities")):typeof define=="function"&&define.amd?define(["exports","@apollo/client/core","@apollo/client/link/context","@apollo/client/link/subscriptions","@apollo/client/utilities"],c):(d=typeof globalThis!="undefined"?globalThis:d||self,c(d["@nhost/apollo"]={},d["@apollo/client/core"],d["@apollo/client/link/context"],d["@apollo/client/link/subscriptions"],d["@apollo/client/utilities"]))})(this,function(d,c,b,ae,se){"use strict";var ge=Object.defineProperty,be=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var xe=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var ie=(d,c,b)=>c in d?ge(d,c,{enumerable:!0,configurable:!0,writable:!0,value:b}):d[c]=b,P=(d,c)=>{for(var b in c||(c={}))xe.call(c,b)&&ie(d,b,c[b]);if(re)for(var b of re(c))ke.call(c,b)&&ie(d,b,c[b]);return d},F=(d,c)=>be(d,he(c));const X=Object.prototype.hasOwnProperty;function B(e){return typeof e=="object"&&e!==null}function ce(e){return Array.isArray(e)&&e.length>0&&e.every(i=>"message"in i)}function G(e,i){return X.call(e,i)}function H(e,i){return X.call(e,i)&&B(e[i])}function q(e,i){return X.call(e,i)&&typeof e[i]=="string"}function ee(e,i){return e.length<124?e:i}const le="graphql-transport-ws";var m;(function(e){e[e.InternalServerError=4500]="InternalServerError",e[e.InternalClientError=4005]="InternalClientError",e[e.BadRequest=4400]="BadRequest",e[e.BadResponse=4004]="BadResponse",e[e.Unauthorized=4401]="Unauthorized",e[e.Forbidden=4403]="Forbidden",e[e.SubprotocolNotAcceptable=4406]="SubprotocolNotAcceptable",e[e.ConnectionInitialisationTimeout=4408]="ConnectionInitialisationTimeout",e[e.ConnectionAcknowledgementTimeout=4504]="ConnectionAcknowledgementTimeout",e[e.SubscriberAlreadyExists=4409]="SubscriberAlreadyExists",e[e.TooManyInitialisationRequests=4429]="TooManyInitialisationRequests"})(m||(m={}));var l;(function(e){e.ConnectionInit="connection_init",e.ConnectionAck="connection_ack",e.Ping="ping",e.Pong="pong",e.Subscribe="subscribe",e.Next="next",e.Error="error",e.Complete="complete"})(l||(l={}));function Y(e){if(B(e)){if(!q(e,"type"))return!1;switch(e.type){case l.ConnectionInit:return!G(e,"payload")||e.payload===void 0||B(e.payload);case l.ConnectionAck:case l.Ping:case l.Pong:return!G(e,"payload")||e.payload===void 0||B(e.payload);case l.Subscribe:return q(e,"id")&&H(e,"payload")&&(!G(e.payload,"operationName")||e.payload.operationName===void 0||e.payload.operationName===null||typeof e.payload.operationName=="string")&&q(e.payload,"query")&&(!G(e.payload,"variables")||e.payload.variables===void 0||e.payload.variables===null||H(e.payload,"variables"))&&(!G(e.payload,"extensions")||e.payload.extensions===void 0||e.payload.extensions===null||H(e.payload,"extensions"));case l.Next:return q(e,"id")&&H(e,"payload");case l.Error:return q(e,"id")&&ce(e.payload);case l.Complete:return q(e,"id");default:return!1}}return!1}function ue(e,i){if(Y(e))return e;if(typeof e!="string")throw new Error("Message not parsable");const w=JSON.parse(e,i);if(!Y(w))throw new Error("Invalid message");return w}function z(e,i){if(!Y(e))throw new Error("Cannot stringify invalid message");return JSON.stringify(e,i)}function de(e){const{url:i,connectionParams:w,lazy:M=!0,onNonLazyError:T=console.error,lazyCloseTimeout:A=0,keepAlive:R=0,disablePong:O,connectionAckWaitTimeout:x=0,retryAttempts:S=5,retryWait:U=async function(p){let s=1e3;for(let o=0;o<p;o++)s*=2;await new Promise(o=>setTimeout(o,s+Math.floor(Math.random()*(3e3-300)+300)))},isFatalConnectionProblem:Q=t=>!v(t),on:n,webSocketImpl:E,generateID:J=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,p=>{const s=Math.random()*16|0;return(p=="x"?s:s&3|8).toString(16)})},jsonMessageReplacer:L,jsonMessageReviver:$}=e;let I;if(E){if(!fe(E))throw new Error("Invalid WebSocket implementation provided");I=E}else typeof WebSocket!="undefined"?I=WebSocket:typeof global!="undefined"?I=global.WebSocket||global.MozWebSocket:typeof window!="undefined"&&(I=window.WebSocket||window.MozWebSocket);if(!I)throw new Error("WebSocket implementation missing; on Node you can `import WebSocket from 'ws';` and pass `webSocketImpl: WebSocket` to `createClient`");const N=I,a=(()=>{const t=(()=>{const s={};return{on(o,u){return s[o]=u,()=>{delete s[o]}},emit(o){var u;"id"in o&&((u=s[o.id])===null||u===void 0||u.call(s,o))}}})(),p={connecting:n!=null&&n.connecting?[n.connecting]:[],opened:n!=null&&n.opened?[n.opened]:[],connected:n!=null&&n.connected?[n.connected]:[],ping:n!=null&&n.ping?[n.ping]:[],pong:n!=null&&n.pong?[n.pong]:[],message:n!=null&&n.message?[t.emit,n.message]:[t.emit],closed:n!=null&&n.closed?[n.closed]:[],error:n!=null&&n.error?[n.error]:[]};return{onMessage:t.on,on(s,o){const u=p[s];return u.push(o),()=>{u.splice(u.indexOf(o),1)}},emit(s,...o){for(const u of[...p[s]])u(...o)}}})();function k(t){const p=[a.on("error",s=>{p.forEach(o=>o()),t(s)}),a.on("closed",s=>{p.forEach(o=>o()),t(s)})]}let h,g=0,Z=!1,K=0,ne=!1;async function te(){const[t,p]=await(h!=null?h:h=new Promise((u,W)=>(async()=>{if(Z){if(await U(K),!g)return h=void 0,W({code:1e3,reason:"All Subscriptions Gone"});K++}a.emit("connecting");const r=new N(typeof i=="function"?await i():i,le);let _,D;function V(){isFinite(R)&&R>0&&(clearTimeout(D),D=setTimeout(()=>{r.readyState===N.OPEN&&(r.send(z({type:l.Ping})),a.emit("ping",!1,void 0))},R))}k(f=>{h=void 0,clearTimeout(_),clearTimeout(D),W(f),v(f)&&f.code===4499&&(r.close(4499,"Terminated"),r.onerror=null,r.onclose=null)}),r.onerror=f=>a.emit("error",f),r.onclose=f=>a.emit("closed",f),r.onopen=async()=>{try{a.emit("opened",r);const f=typeof w=="function"?await w():w;if(r.readyState!==N.OPEN)return;r.send(z(f?{type:l.ConnectionInit,payload:f}:{type:l.ConnectionInit},L)),isFinite(x)&&x>0&&(_=setTimeout(()=>{r.close(m.ConnectionAcknowledgementTimeout,"Connection acknowledgement timeout")},x)),V()}catch(f){a.emit("error",f),r.close(m.InternalClientError,ee(f instanceof Error?f.message:new Error(f).message,"Internal client error"))}};let C=!1;r.onmessage=({data:f})=>{try{const y=ue(f,$);if(a.emit("message",y),y.type==="ping"||y.type==="pong"){a.emit(y.type,!0,y.payload),y.type==="pong"?V():O||(r.send(z(y.payload?{type:l.Pong,payload:y.payload}:{type:l.Pong})),a.emit("pong",!1,y.payload));return}if(C)return;if(y.type!==l.ConnectionAck)throw new Error(`First message cannot be of type ${y.type}`);clearTimeout(_),C=!0,a.emit("connected",r,y.payload),Z=!1,K=0,u([r,new Promise((Se,we)=>k(we))])}catch(y){r.onmessage=null,a.emit("error",y),r.close(m.BadResponse,ee(y instanceof Error?y.message:new Error(y).message,"Bad response"))}}})()));t.readyState===N.CLOSING&&await p;let s=()=>{};const o=new Promise(u=>s=u);return[t,s,Promise.race([o.then(()=>{if(!g){const u=()=>t.close(1e3,"Normal Closure");isFinite(A)&&A>0?setTimeout(()=>{!g&&t.readyState===N.OPEN&&u()},A):u()}}),p])]}function oe(t){if(v(t)&&(pe(t.code)||[m.InternalServerError,m.InternalClientError,m.BadRequest,m.BadResponse,m.Unauthorized,m.SubprotocolNotAcceptable,m.SubscriberAlreadyExists,m.TooManyInitialisationRequests].includes(t.code)))throw t;if(ne)return!1;if(v(t)&&t.code===1e3)return g>0;if(!S||K>=S||Q(t))throw t;return Z=!0}return M||(async()=>{for(g++;;)try{const[,,t]=await te();await t}catch(t){try{if(!oe(t))return}catch(p){return T==null?void 0:T(p)}}})(),{on:a.on,subscribe(t,p){const s=J();let o=!1,u=!1,W=()=>{g--,o=!0};return(async()=>{for(g++;;)try{const[r,_,D]=await te();if(o)return _();const V=a.onMessage(s,C=>{switch(C.type){case l.Next:{p.next(C.payload);return}case l.Error:{u=!0,o=!0,p.error(C.payload),W();return}case l.Complete:{o=!0,W();return}}});r.send(z({id:s,type:l.Subscribe,payload:t},L)),W=()=>{!o&&r.readyState===N.OPEN&&r.send(z({id:s,type:l.Complete},L)),g--,o=!0,_()},await D.finally(V);return}catch(r){if(!oe(r))return}})().then(()=>{u||p.complete()}).catch(r=>{p.error(r)}),()=>{o||W()}},async dispose(){if(ne=!0,h){const[t]=await h;t.close(1e3,"Normal Closure")}},terminate(){h&&a.emit("closed",{code:4499,reason:"Terminated",wasClean:!1})}}}function v(e){return B(e)&&"code"in e&&"reason"in e}function pe(e){return[1e3,1001,1006,1005,1012,1013,1013].includes(e)?!1:e>=1e3&&e<=1999}function fe(e){return typeof e=="function"&&"constructor"in e&&"CLOSED"in e&&"CLOSING"in e&&"CONNECTING"in e&&"OPEN"in e}function ye(e){let i=!1,w=()=>{i=!0},M=!1;const T=()=>M,A=de(F(P({},e),{on:F(P({},e.on),{connected:()=>{M=!0},opened:R=>{var x,S;const O=R;(S=(x=e.on)==null?void 0:x.opened)==null||S.call(x,O),w=()=>{O.readyState===WebSocket.OPEN?O.close(4205,"Client Restart"):i=!0},i&&(i=!1,w())}})}));return F(P({},A),{restart:()=>w(),started:T})}const j=typeof window!="undefined",me=({nhost:e,graphqlUrl:i,headers:w={},publicRole:M="public",fetchPolicy:T,cache:A=new c.InMemoryCache,connectToDevTools:R=j&&!1,onError:O})=>{let x=i||(e==null?void 0:e.graphql.getUrl());if(!x)throw Error("Can't initialize the Apollo Client: no backend Url has been provided");const S=e==null?void 0:e.auth.client.interpreter;let U=null;const Q=()=>{const a=F(P({},w),{"Sec-WebSocket-Protocol":"graphql-ws"});return U?a.authorization=`Bearer ${U}`:a.role=M,a},n=x,E=j&&ye({url:n.startsWith("https")?n.replace(/^https/,"wss"):n.replace(/^http/,"ws"),connectionParams:()=>({headers:P(P({},w),Q())})}),J=E&&new ae.GraphQLWsLink(E),L=b.setContext((a,{headers:k})=>({headers:P(P({},k),Q())})).concat(c.createHttpLink({uri:n})),$=J?c.split(({query:a})=>{const k=se.getMainDefinition(a),{kind:h}=k;let g;return"operation"in k&&(g=k.operation),h==="OperationDefinition"&&g==="subscription"},J,L):L,I={cache:A||new c.InMemoryCache,ssrMode:!j,defaultOptions:{watchQuery:{fetchPolicy:T}},connectToDevTools:R};I.link=typeof O=="function"?c.from([O,$]):c.from([$]);const N=new c.ApolloClient(I);return S==null||S.onTransition(async(a,k)=>{if(["SIGNOUT","SIGNED_IN","TOKEN_CHANGED"].includes(k.type))if(U=a.context.accessToken.value,k.type==="SIGNOUT")try{await N.resetStore()}catch(g){console.error("Error resetting Apollo client cache"),console.error(g)}else j&&E&&E.started()&&E.restart()}),N};d.createApolloClient=me,Object.defineProperties(d,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=apollo.umd.js.map
